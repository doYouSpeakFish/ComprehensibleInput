#!/usr/bin/env bash
set -euo pipefail

# Ensure we run from repo root
repo_root="$(git rev-parse --show-toplevel)"
cd "$repo_root"

current_user="$(git config user.name || echo)"
if [[ "$current_user" != "Codex" ]]; then
  exit 0
fi

if git diff --cached --name-only -- app/screenshots | grep -q .; then
  echo "Codex commits may not modify app/screenshots. Reverting staged changes in app/screenshots/."
  git restore --staged --worktree --source=HEAD -- app/screenshots 2>/dev/null || true
  git clean -fd -- app/screenshots >/dev/null 2>&1 || true
fi

exit 0
